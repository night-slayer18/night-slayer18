# GitHub Profile README Auto-Update Workflow
# This workflow automatically updates the README.md daily at 12 AM UTC
# It updates dynamic sections like GitHub Activity and Blog Posts
#
# To customize:
# 1. Uncomment sections you want to enable (WakaTime, Blog Posts)
# 2. Configure the required secrets and integrations
# 3. Adjust the cron schedule if needed

name: Update GitHub Profile README

on:
  # Runs daily at 12 AM UTC (midnight)
  schedule:
    - cron: "0 0 * * *"
  
  # Allows manual trigger from Actions tab
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-readme:
    name: Update README with Dynamic Content
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      # Step 2: Update Recent GitHub Activity
      # This action updates the <!--START_SECTION:activity--> section in README
      - name: Update GitHub Activity
        uses: jamesgeorge007/github-activity-readme@v1.5.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          COMMIT_MSG: "‚ö° Update GitHub activity in README"
          MAX_LINES: 5
        continue-on-error: true

      # Step 3: Blog Posts from Dev.to, Medium, Hashnode (Optional)
      # Uncomment the section below after adding your blog feed URL
      # 
      # - name: Update Blog Posts
      #   uses: gautamkrishnar/blog-post-workflow@v1
      #   with:
      #     feed_list: "https://dev.to/feed/night-slayer18,https://medium.com/feed/@night-slayer18"
      #     max_post_count: 5
      #     readme_path: "./README.md"
      #     comment_tag_name: "BLOG-POST-LIST"
      #     commit_message: "üìù Update blog posts in README"
      #   continue-on-error: true

      # Step 4: WakaTime Coding Stats (Optional)
      # Uncomment after setting up WakaTime and adding WAKATIME_API_KEY secret
      #
      # - name: Update WakaTime Stats
      #   uses: anmol098/waka-readme-stats@v4
      #   with:
      #     WAKATIME_API_KEY: ${{ secrets.WAKATIME_API_KEY }}
      #     GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      #     SHOW_LINES_OF_CODE: true
      #     SHOW_PROFILE_VIEWS: false
      #     SHOW_DAYS_OF_WEEK: true
      #     SHOW_SHORT_INFO: false
      #   continue-on-error: true

      # Step 5: Commit and push any remaining changes
      - name: Commit and Push Changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          # Only commit if there are changes
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "üîÑ Auto-update README with latest activity [skip ci]"
            git push
          fi
        continue-on-error: true
